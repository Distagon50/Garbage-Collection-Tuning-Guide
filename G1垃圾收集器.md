
G1垃圾收集器简介
=

G1垃圾收集器是为具有大内存的多处理器机器设计的。它在实现高吞吐量的同时，大概率可以满足垃圾收集暂对停时间的要求。G1旨在系统的延迟和吞吐量之间达到一个完美的平衡。
* 堆的大小多达十多个G乃至更多，并且50%以上的堆被数据占满。
* 随着时间的推移，对象分配和变老的速度差别非常大。
* 中有大量的内存碎片。
* 预测的暂停时间目标不超过几百毫秒，避免长时间的垃圾收集暂停。

G1取代了CMS成为默认的垃圾收集器。
G1收集器实现了高性能，并尝试实现暂停时间的目标。具体如下。

启用G1
=

G1是默认收集器，因此通常不需要执行任何其他操作。也可以用命令行选项-XX:+UseG1GC启用。

基本概念
=

G1是一种分代、增量、并行、多并发、停止世界(STW)和清空垃圾收集器的工作，它监视每一个垃圾收集暂停时间的目标。与其他收集器类似，G1将堆划分为(虚拟的)年轻的和老年代。空间回收再利用大部分时候集中在年轻代，因为效率最高，只有在偶尔的情况下才会发生在老年代。
 
为了提高吞吐量，一些操作总是会在STW的停顿中执行。其他需要更多时间处理的操作，如全局标记之类的全堆操作，都是并行执行的，并与应用程序并发。为了使内存再回收时STW尽可能的短，G1会以步进且并行的方式逐步进行空间回收再利用。G1通过跟踪相关应用程序之前行为的信息和垃圾收集暂停来构建相关成本的模型，从而达到可预测性。它使用这些信息来对暂停中完成的工作进行大小调整。例如，G1在最有效的区域(即大部分是垃圾的区域)回收并重分配空间。
 
G1回收内存主要是通过疏散的方式:在选定的内存区域内发现的活动对象会被复制到新的内存区域，并在复制的过程被压缩(注：这里的压缩是指将本来不同的内存块紧密相连以避免内存碎片)。在疏散完成后，本来由活动对象占用的空间就可以被应用程序重新分配。
 
G1垃圾收集器不是实时收集器。它会尝试在很长的时间段达到设定的暂停时间目标，并且有很大概率可以做到，但并没有绝对的确定性。

对内存布局
=

G1将堆划分为一组大小相等的堆区域，每个区域都是一个连续的虚拟内存快，如图9-1所示。区域是内存分配和内存回收再利用的最小单位。在任何给定的时间，这些区域都可能是空的(浅灰色)，或者分配给某个特定的世代，年轻代或年老的。当内存请求进来时，内存管理器会释放出空闲区域。内存管理器将它们分配给一个生成，然后将它们作为空闲空间返回给应用程序，以便它可以分配自己。

图9-1
![Figure 9-1](https://github.com/Distagon50/Garbage-Collection-Tuning-Guide/blob/master/Images/jsgct_dt_004_grbg_frst_hp.png)
